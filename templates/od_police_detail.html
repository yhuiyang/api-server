{% extends "base.html" %}

{% block mediaCSS %}
<style type="text/css">
@media (min-width: 981px) {
    body {
        padding-top: 60px;
    }
}
.google-map-canvas {
    height: 280px;
    width: 320px;
}
</style>
{% endblock mediaCSS %}

{% block navbar_list_items %}
{% if counties %}
<li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">{% if client_county %}{{ client_county }}{% else %}Select County{% endif %}<span class="caret"></span></a>
    <ul class="dropdown-menu">
        {% for county_name in counties.iterkeys() %}
        <li><a tabindex="-1" href="?county={{ county_name }}">{{ county_name }} ({{ counties[county_name] | count }})</a></li>
        {% endfor %}
    </ul>
</li>
<li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown">{% if client_township %}{{ client_township }}{% else %}Select Township{% endif %}<span class="caret"></span></a>
    <ul class="dropdown-menu">
        {% if client_county %}
            {% for township in counties[client_county] %}
            <li><a tabindex="-1" href="?county={{ client_county }}&township={{ township }}">{{ township }}</a></li>
            {% endfor %}
        {% else %}
        <li><a>Select county first.</a></li>
        {% endif %}
    </ul>
</li>
<li class="divider-vertical"></li>
{% endif %}
<li>
    <div class="btn-group">
        <a href="/opendata/police_stations" class="btn"><i class="icon-arrow-left"></i><span>Back to police stations</span></a>
    </div>
</li>
{% endblock navbar_list_items %}

{% macro pagination(entries) -%}
<div class="pagination pagination-right">
    <ul>
        {% for entry in entries %}
        <li{% if entry.disabled %} class="disabled"{% endif %}{% if entry.active %} class="active"{% endif %}><a href="{{ entry.link }}">{{ entry.label }}</a></li>
        {% endfor %}
    </ul>
</div>
{%- endmacro %}
{% macro pager(p) -%}
<div class="pager">
    <li class="previous{% if p[0].disabled %} disabled{% endif %}">
        <a href="{{ p[0].link }}">&larr; Prev</a>
    </li>
    <li class="next{% if p[1].disabled %} disabled{% endif %}">
        <a href="{{ p[1].link }}">Next &rarr;</a>
    </li>
</div>
{%- endmacro %}

{% block content %}
{% if police_stations %}
<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>#</th>
            <th>Name</th>
            <th>Tel</th>
            <th>Address</th>
            <th>x/y</th>
            <th>Lat/Lng</th>
            <th>Map</th>
        </tr>
    </thead>
    <tbody>
    {% for ps in police_stations %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ ps.name }}</td>
            <td>{{ ps.tel }}</td>
            <td>{{ ps.address }}</td>
            <td>{{ ps.xy[0] }}<br>{{ ps.xy[1] }}</td>
            <td>{{ ps.latlng }}</td>
            <td><div class="google-map-canvas" /></td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>Select County and Township in navbar to show detailed information for police stations within specific township.</p>
{% endif %}
{% endblock content %}

{% block mediaJS %}
<script type="text/javascript"
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD2wYBzKkrqNYRkCEbT8MitMzbCF4m0vBU&sensor=false&v=3"></script>
<script type="text/javascript">
$(document).ready(function(){

    {% if police_stations %}
        var maps = new Array();
        var markers = new Array();

        google.maps.visualRefresh = true;
        var mapOptions;
        var latLng;
        var latLngText;
        var split;

        var domMaps = document.getElementsByClassName('google-map-canvas');
        var mapCount = domMaps.length;
        for (var idx = 0; idx < mapCount; idx++) {

            /* retrieve latlng text and convert to LatLng */
            latLngText = domMaps[idx].parentElement.previousElementSibling.innerText;
            split = latLngText.split(',');
            latLng = new google.maps.LatLng(parseFloat(split[0]), parseFloat(split[1]));

            /* map */
            mapOptions = {
                center: latLng,
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            maps[idx] = new google.maps.Map(domMaps[idx], mapOptions);

            /* marker */
            markers[idx] = new google.maps.Marker({
                map: maps[idx],
                position: latLng,
                title: 'title'
            });
        }
    {% endif %}
});
</script>
{% endblock mediaJS %}
